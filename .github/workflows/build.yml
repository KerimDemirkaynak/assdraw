name: Build ASSDraw3 Multi-Platform

on:
  push:
    branches: [ master, main ]
  pull_request:
    branches: [ master, main ]

jobs:
  # ------------------------------------------------------------------
  # WINDOWS BUILD (Inno Setup Dahil)
  # ------------------------------------------------------------------
  build-windows:
    runs-on: windows-latest
    
    steps:
    - uses: actions/checkout@v4

    - name: Setup vcpkg (Windows)
      uses: lukka/run-vcpkg@v11
      with:
        vcpkgJsonGlob: 'vcpkg.json'

    - name: Setup CMake
      uses: lukka/get-cmake@latest
    
    - name: Configure CMake
      run: |
        cmake -S . -B build -DCMAKE_TOOLCHAIN_FILE=${{ env.VCPKG_ROOT }}/scripts/buildsystems/vcpkg.cmake -DCMAKE_BUILD_TYPE=Release

    - name: Build
      run: |
        cmake --build build --config Release

    - name: Build Installer (Inno Setup)
      uses: Minionguyjosh/innosetup-action@v1.6.0
      with:
        path: installer.iss

    - name: Upload Windows Artifacts
      uses: actions/upload-artifact@v4
      with:
        name: ASSDraw3-Windows
        path: |
          build/Release/ASSDraw3.exe
          Output/ASSDraw3_Setup.exe

  # ------------------------------------------------------------------
  # LINUX BUILD (Ubuntu)
  # ------------------------------------------------------------------
  build-linux:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    # Linux'ta vcpkg'nin wxWidgets'i derleyebilmesi için sistem bağımlılıkları gereklidir
    - name: Install System Dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y build-essential pkg-config libgtk-3-dev libsecret-1-dev libgcrypt20-dev libsystemd-dev freeglut3-dev libnotify-dev libsdl2-dev

    - name: Setup vcpkg (Linux)
      uses: lukka/run-vcpkg@v11
      with:
        vcpkgJsonGlob: 'vcpkg.json'

    - name: Setup CMake
      uses: lukka/get-cmake@latest

    - name: Configure CMake
      run: |
        cmake -S . -B build -DCMAKE_TOOLCHAIN_FILE=${{ env.VCPKG_ROOT }}/scripts/buildsystems/vcpkg.cmake -DCMAKE_BUILD_TYPE=Release

    - name: Build
      run: |
        cmake --build build --config Release

    # Linux çıktısı (uzantısız binary dosyası)
    - name: Upload Linux Artifact
      uses: actions/upload-artifact@v4
      with:
        name: ASSDraw3-Linux
        path: build/ASSDraw3
